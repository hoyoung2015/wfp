package net.hoyoung.wfp.stockdown;

import java.util.Calendar;
import java.util.List;
import java.util.regex.Pattern;

import org.apache.commons.lang3.builder.ToStringBuilder;
import org.junit.Test;

import com.alibaba.fastjson.JSON;
import com.alibaba.fastjson.JSONObject;
import com.alibaba.fastjson.JSONPath;

import net.hoyoung.wfp.core.entity.CompanyInfo;
import us.codecraft.webmagic.selector.XpathSelector;

/**
 * Created by hoyoung on 16-5-14.
 */

public class TestA {
	@Test
	public void test() {
		String str = "{sum:2905,list:[{Number:'1',StockNameLink:'s601857.shtml',Stockname:'中国石油(601857)',Pricelimit:'1830.21',lootchips:'1619.22',shareholders:'11706.97',Institutional:'18302097.78',Iratio:'--',deviation:'<a href=jhy-0533.shtml target=\"_blank\">石油勘探与开采</a>',maincost:'<span  onmouseover=openshowd(this,\"601857\",\"1\")  onmouseout=\"Closed(this)\" ><a href=jgn-gn_bxzc.shtml target=\"_blank\">保险重仓</a></span>',district:'<a href=jdy-301000000.shtml target=\"_blank\">北京</a>',Cprice:'7.33',Stockoverview:'详查',Addoptional:'<img alt=\"\" src=\"img/icon_02.gif\"/>',hyLink:'jhy-0533.shtml',gnLink:'jgn-gn_bxzc.shtml',dyLink:'jdy-301000000.shtml',StockLink:'http://stockdata.stock.hexun.com/601857.shtml'},{Number:'2',StockNameLink:'s601398.shtml',Stockname:'工商银行(601398)',Pricelimit:'3564.06',lootchips:'2696.12',shareholders:'11620.29',Institutional:'35640625.71',Iratio:'5.14',deviation:'<a href=jhy-8355.shtml target=\"_blank\">银行业（IV）</a>',maincost:'<span  onmouseover=openshowd(this,\"601398\",\"1\")  onmouseout=\"Closed(this)\" ><a href=jgn-gn_bxzc.shtml target=\"_blank\">保险重仓</a></span>',district:'<a href=jdy-301000000.shtml target=\"_blank\">北京</a>',Cprice:'4.31',Stockoverview:'详查',Addoptional:'<img alt=\"\" src=\"img/icon_02.gif\"/>',hyLink:'jhy-8355.shtml',gnLink:'jgn-gn_bxzc.shtml',dyLink:'jdy-301000000.shtml',StockLink:'http://stockdata.stock.hexun.com/601398.shtml'},{Number:'3',StockNameLink:'s601288.shtml',Stockname:'农业银行(601288)',Pricelimit:'3247.94',lootchips:'2940.55',shareholders:'9174.53',Institutional:'32479411.70',Iratio:'4.63',deviation:'<a href=jhy-8355.shtml target=\"_blank\">银行业（IV）</a>',maincost:'<span  onmouseover=openshowd(this,\"601288\",\"1\")  onmouseout=\"Closed(this)\" ><a href=jgn-gn_bxzc.shtml target=\"_blank\">保险重仓</a></span>',district:'<a href=jdy-301000000.shtml target=\"_blank\">北京</a>',Cprice:'3.12',Stockoverview:'详查',Addoptional:'<img alt=\"\" src=\"img/icon_02.gif\"/>',hyLink:'jhy-8355.shtml',gnLink:'jgn-gn_bxzc.shtml',dyLink:'jdy-301000000.shtml',StockLink:'http://stockdata.stock.hexun.com/601288.shtml'},{Number:'4',StockNameLink:'s601988.shtml',Stockname:'中国银行(601988)',Pricelimit:'2943.88',lootchips:'2107.66',shareholders:'7039.57',Institutional:'29438779.12',Iratio:'5.27',deviation:'<a href=jhy-8355.shtml target=\"_blank\">银行业（IV）</a>',maincost:'<span  onmouseover=openshowd(this,\"601988\",\"1\")  onmouseout=\"Closed(this)\" ><a href=jgn-gn_bxzc.shtml target=\"_blank\">保险重仓</a></span>',district:'<a href=jdy-301000000.shtml target=\"_blank\">北京</a>',Cprice:'3.36',Stockoverview:'详查',Addoptional:'<img alt=\"\" src=\"img/icon_02.gif\"/>',hyLink:'jhy-8355.shtml',gnLink:'jgn-gn_bxzc.shtml',dyLink:'jdy-301000000.shtml',StockLink:'http://stockdata.stock.hexun.com/601988.shtml'},{Number:'5',StockNameLink:'s600028.shtml',Stockname:'中国石化(600028)',Pricelimit:'1210.71',lootchips:'955.58',shareholders:'4634.55',Institutional:'12107120.96',Iratio:'23.73',deviation:'<a href=jhy-0533.shtml target=\"_blank\">石油勘探与开采</a>',maincost:'<span  onmouseover=openshowd(this,\"600028\",\"1\")  onmouseout=\"Closed(this)\" ><a href=jgn-gn_bxzc.shtml target=\"_blank\">保险重仓</a></span>',district:'<a href=jdy-301000000.shtml target=\"_blank\">北京</a>',Cprice:'4.85',Stockoverview:'详查',Addoptional:'<img alt=\"\" src=\"img/icon_02.gif\"/>',hyLink:'jhy-0533.shtml',gnLink:'jgn-gn_bxzc.shtml',dyLink:'jdy-301000000.shtml',StockLink:'http://stockdata.stock.hexun.com/600028.shtml'},{Number:'6',StockNameLink:'s601628.shtml',Stockname:'中国人寿(601628)',Pricelimit:'282.65',lootchips:'208.24',shareholders:'4460.40',Institutional:'2826470.50',Iratio:'28.82',deviation:'<a href=jhy-8578.shtml target=\"_blank\">人寿保险（IV）</a>',maincost:'<span  onmouseover=openshowd(this,\"601628\",\"1\")  onmouseout=\"Closed(this)\" ><a href=jgn-gn_bxzc.shtml target=\"_blank\">保险重仓</a></span>',district:'<a href=jdy-301000000.shtml target=\"_blank\">北京</a>',Cprice:'21.25',Stockoverview:'详查',Addoptional:'<img alt=\"\" src=\"img/icon_02.gif\"/>',hyLink:'jhy-8578.shtml',gnLink:'jgn-gn_bxzc.shtml',dyLink:'jdy-301000000.shtml',StockLink:'http://stockdata.stock.hexun.com/601628.shtml'},{Number:'7',StockNameLink:'s600519.shtml',Stockname:'贵州茅台(600519)',Pricelimit:'12.56',lootchips:'12.56',shareholders:'3944.59',Institutional:'125619.78',Iratio:'20.17',deviation:'<a href=jhy-3535.shtml target=\"_blank\">蒸馏酒与葡萄酒</a>',maincost:'<span  onmouseover=openshowd(this,\"600519\",\"1\")  onmouseout=\"Closed(this)\" ><a href=jgn-gn_bxzc.shtml target=\"_blank\">保险重仓</a></span>',district:'<a href=jdy-321000000.shtml target=\"_blank\">贵州</a>',Cprice:'319.04',Stockoverview:'详查',Addoptional:'<img alt=\"\" src=\"img/icon_02.gif\"/>',hyLink:'jhy-3535.shtml',gnLink:'jgn-gn_bxzc.shtml',dyLink:'jdy-321000000.shtml',StockLink:'http://stockdata.stock.hexun.com/600519.shtml'},{Number:'8',StockNameLink:'s600036.shtml',Stockname:'招商银行(600036)',Pricelimit:'252.20',lootchips:'206.29',shareholders:'3583.25',Institutional:'2521984.56',Iratio:'5.97',deviation:'<a href=jhy-8355.shtml target=\"_blank\">银行业（IV）</a>',maincost:'<span  onmouseover=openshowd(this,\"600036\",\"1\")  onmouseout=\"Closed(this)\" ><a href=jgn-gn_bxzc.shtml target=\"_blank\">保险重仓</a></span>',district:'<a href=jdy-304000000.shtml target=\"_blank\">广东</a>',Cprice:'17.17',Stockoverview:'详查',Addoptional:'<img alt=\"\" src=\"img/icon_02.gif\"/>',hyLink:'jhy-8355.shtml',gnLink:'jgn-gn_bxzc.shtml',dyLink:'jdy-304000000.shtml',StockLink:'http://stockdata.stock.hexun.com/600036.shtml'},{Number:'9',StockNameLink:'s601318.shtml',Stockname:'中国平安(601318)',Pricelimit:'182.80',lootchips:'108.33',shareholders:'3552.03',Institutional:'1828024.14',Iratio:'7.24',deviation:'<a href=jhy-8578.shtml target=\"_blank\">人寿保险（IV）</a>',maincost:'<span  onmouseover=openshowd(this,\"601318\",\"1\")  onmouseout=\"Closed(this)\" ><a href=jgn-gn_cdp.shtml target=\"_blank\">超大盘</a></span>',district:'<a href=jdy-304000000.shtml target=\"_blank\">广东</a>',Cprice:'32.52',Stockoverview:'详查',Addoptional:'<img alt=\"\" src=\"img/icon_02.gif\"/>',hyLink:'jhy-8578.shtml',gnLink:'jgn-gn_cdp.shtml',dyLink:'jdy-304000000.shtml',StockLink:'http://stockdata.stock.hexun.com/601318.shtml'},{Number:'10',StockNameLink:'s600000.shtml',Stockname:'浦发银行(600000)',Pricelimit:'216.18',lootchips:'205.19',shareholders:'3256.34',Institutional:'2161827.99',Iratio:'6.16',deviation:'<a href=jhy-8355.shtml target=\"_blank\">银行业（IV）</a>',maincost:'<span  onmouseover=openshowd(this,\"600000\",\"1\")  onmouseout=\"Closed(this)\" ><a href=jgn-gn_bxzc.shtml target=\"_blank\">保险重仓</a></span>',district:'<a href=jdy-302000000.shtml target=\"_blank\">上海</a>',Cprice:'15.74',Stockoverview:'详查',Addoptional:'<img alt=\"\" src=\"img/icon_02.gif\"/>',hyLink:'jhy-8355.shtml',gnLink:'jgn-gn_bxzc.shtml',dyLink:'jdy-302000000.shtml',StockLink:'http://stockdata.stock.hexun.com/600000.shtml'},{Number:'11',StockNameLink:'s601166.shtml',Stockname:'兴业银行(601166)',Pricelimit:'190.52',lootchips:'190.52',shareholders:'2945.49',Institutional:'1905233.68',Iratio:'4.69',deviation:'<a href=jhy-8355.shtml target=\"_blank\">银行业（IV）</a>',maincost:'<span  onmouseover=openshowd(this,\"601166\",\"1\")  onmouseout=\"Closed(this)\" ><a href=jgn-gn_jjzc.shtml target=\"_blank\">基金重仓</a></span>',district:'<a href=jdy-330000000.shtml target=\"_blank\">福建</a>',Cprice:'15.46',Stockoverview:'详查',Addoptional:'<img alt=\"\" src=\"img/icon_02.gif\"/>',hyLink:'jhy-8355.shtml',gnLink:'jgn-gn_jjzc.shtml',dyLink:'jdy-330000000.shtml',StockLink:'http://stockdata.stock.hexun.com/601166.shtml'},{Number:'12',StockNameLink:'s600016.shtml',Stockname:'民生银行(600016)',Pricelimit:'364.85',lootchips:'295.52',shareholders:'2730.58',Institutional:'3648534.88',Iratio:'6.15',deviation:'<a href=jhy-8355.shtml target=\"_blank\">银行业（IV）</a>',maincost:'<span  onmouseover=openshowd(this,\"600016\",\"1\")  onmouseout=\"Closed(this)\" ><a href=jgn-gn_bxzc.shtml target=\"_blank\">保险重仓</a></span>',district:'<a href=jdy-301000000.shtml target=\"_blank\">北京</a>',Cprice:'9.23',Stockoverview:'详查',Addoptional:'<img alt=\"\" src=\"img/icon_02.gif\"/>',hyLink:'jhy-8355.shtml',gnLink:'jgn-gn_bxzc.shtml',dyLink:'jdy-301000000.shtml',StockLink:'http://stockdata.stock.hexun.com/600016.shtml'},{Number:'13',StockNameLink:'s600104.shtml',Stockname:'上汽集团(600104)',Pricelimit:'110.26',lootchips:'110.26',shareholders:'2534.78',Institutional:'1102556.66',Iratio:'7.99',deviation:'<a href=jhy-3353.shtml target=\"_blank\">汽车</a>',maincost:'<span  onmouseover=openshowd(this,\"600104\",\"1\")  onmouseout=\"Closed(this)\" ><a href=jgn-gn_bxzc.shtml target=\"_blank\">保险重仓</a></span>',district:'<a href=jdy-302000000.shtml target=\"_blank\">上海</a>',Cprice:'22.71',Stockoverview:'详查',Addoptional:'<img alt=\"\" src=\"img/icon_02.gif\"/>',hyLink:'jhy-3353.shtml',gnLink:'jgn-gn_bxzc.shtml',dyLink:'jdy-302000000.shtml',StockLink:'http://stockdata.stock.hexun.com/600104.shtml'},{Number:'14',StockNameLink:'s601088.shtml',Stockname:'中国神华(601088)',Pricelimit:'198.90',lootchips:'164.91',shareholders:'2419.24',Institutional:'1988962.05',Iratio:'15.83',deviation:'<a href=jhy-1771.shtml target=\"_blank\">煤炭开采</a>',maincost:'<span  onmouseover=openshowd(this,\"601088\",\"1\")  onmouseout=\"Closed(this)\" ><a href=jgn-gn_bxzc.shtml target=\"_blank\">保险重仓</a></span>',district:'<a href=jdy-301000000.shtml target=\"_blank\">北京</a>',Cprice:'14.86',Stockoverview:'详查',Addoptional:'<img alt=\"\" src=\"img/icon_02.gif\"/>',hyLink:'jhy-1771.shtml',gnLink:'jgn-gn_bxzc.shtml',dyLink:'jdy-301000000.shtml',StockLink:'http://stockdata.stock.hexun.com/601088.shtml'},{Number:'15',StockNameLink:'s601328.shtml',Stockname:'交通银行(601328)',Pricelimit:'742.63',lootchips:'392.51',shareholders:'2229.45',Institutional:'7426272.66',Iratio:'5.53',deviation:'<a href=jhy-8355.shtml target=\"_blank\">银行业（IV）</a>',maincost:'<span  onmouseover=openshowd(this,\"601328\",\"1\")  onmouseout=\"Closed(this)\" ><a href=jgn-gn_hHg.shtml target=\"_blank\">含H股</a></span>',district:'<a href=jdy-302000000.shtml target=\"_blank\">上海</a>',Cprice:'5.61',Stockoverview:'详查',Addoptional:'<img alt=\"\" src=\"img/icon_02.gif\"/>',hyLink:'jhy-8355.shtml',gnLink:'jgn-gn_hHg.shtml',dyLink:'jdy-302000000.shtml',StockLink:'http://stockdata.stock.hexun.com/601328.shtml'},{Number:'16',StockNameLink:'s601766.shtml',Stockname:'中国中车(601766)',Pricelimit:'272.89',lootchips:'229.18',shareholders:'2094.68',Institutional:'2728875.83',Iratio:'31.37',deviation:'<a href=jhy-2753.shtml target=\"_blank\">商用运载工具与车辆</a>',maincost:'<span  onmouseover=openshowd(this,\"601766\",\"1\")  onmouseout=\"Closed(this)\" ><a href=jgn-gn_bxzc.shtml target=\"_blank\">保险重仓</a></span>',district:'<a href=jdy-301000000.shtml target=\"_blank\">北京</a>',Cprice:'9.24',Stockoverview:'详查',Addoptional:'<img alt=\"\" src=\"img/icon_02.gif\"/>',hyLink:'jhy-2753.shtml',gnLink:'jgn-gn_bxzc.shtml',dyLink:'jdy-301000000.shtml',StockLink:'http://stockdata.stock.hexun.com/601766.shtml'},{Number:'17',StockNameLink:'s601998.shtml',Stockname:'中信银行(601998)',Pricelimit:'489.35',lootchips:'319.05',shareholders:'1891.98',Institutional:'4893479.66',Iratio:'6.48',deviation:'<a href=jhy-8355.shtml target=\"_blank\">银行业（IV）</a>',maincost:'<span  onmouseover=openshowd(this,\"601998\",\"1\")  onmouseout=\"Closed(this)\" ><a href=jgn-gn_hHg.shtml target=\"_blank\">含H股</a></span>',district:'<a href=jdy-301000000.shtml target=\"_blank\">北京</a>',Cprice:'5.90',Stockoverview:'详查',Addoptional:'<img alt=\"\" src=\"img/icon_02.gif\"/>',hyLink:'jhy-8355.shtml',gnLink:'jgn-gn_hHg.shtml',dyLink:'jdy-301000000.shtml',StockLink:'http://stockdata.stock.hexun.com/601998.shtml'},{Number:'18',StockNameLink:'s601601.shtml',Stockname:'中国太保(601601)',Pricelimit:'90.62',lootchips:'62.87',shareholders:'1735.13',Institutional:'906200.00',Iratio:'28.43',deviation:'<a href=jhy-8578.shtml target=\"_blank\">人寿保险（IV）</a>',maincost:'<span  onmouseover=openshowd(this,\"601601\",\"1\")  onmouseout=\"Closed(this)\" ><a href=jgn-gn_hHg.shtml target=\"_blank\">含H股</a></span>',district:'<a href=jdy-302000000.shtml target=\"_blank\">上海</a>',Cprice:'27.08',Stockoverview:'详查',Addoptional:'<img alt=\"\" src=\"img/icon_02.gif\"/>',hyLink:'jhy-8578.shtml',gnLink:'jgn-gn_hHg.shtml',dyLink:'jdy-302000000.shtml',StockLink:'http://stockdata.stock.hexun.com/601601.shtml'},{Number:'19',StockNameLink:'s000002.shtml',Stockname:'万科A(000002)',Pricelimit:'110.39',lootchips:'97.08',shareholders:'1691.19',Institutional:'1103915.20',Iratio:'57.70',deviation:'<a href=jhy-8733.shtml target=\"_blank\">不动产投资开发</a>',maincost:'<span  onmouseover=openshowd(this,\"000002\",\"1\")  onmouseout=\"Closed(this)\" ><a href=jgn-gn_bxzc.shtml target=\"_blank\">保险重仓</a></span>',district:'<a href=jdy-304000000.shtml target=\"_blank\">广东</a>',Cprice:'17.78',Stockoverview:'详查',Addoptional:'<img alt=\"\" src=\"img/icon_02.gif\"/>',hyLink:'jhy-8733.shtml',gnLink:'jgn-gn_bxzc.shtml',dyLink:'jdy-304000000.shtml',StockLink:'http://stockdata.stock.hexun.com/000002.shtml'},{Number:'20',StockNameLink:'s601668.shtml',Stockname:'中国建筑(601668)',Pricelimit:'300.00',lootchips:'299.47',shareholders:'1686.01',Institutional:'3000000.00',Iratio:'6.62',deviation:'<a href=jhy-2357.shtml target=\"_blank\">建筑施工</a>',maincost:'<span  onmouseover=openshowd(this,\"601668\",\"1\")  onmouseout=\"Closed(this)\" ><a href=jgn-gn_bxzc.shtml target=\"_blank\">保险重仓</a></span>',district:'<a href=jdy-301000000.shtml target=\"_blank\">北京</a>',Cprice:'5.56',Stockoverview:'详查',Addoptional:'<img alt=\"\" src=\"img/icon_02.gif\"/>',hyLink:'jhy-2357.shtml',gnLink:'jgn-gn_bxzc.shtml',dyLink:'jdy-301000000.shtml',StockLink:'http://stockdata.stock.hexun.com/601668.shtml'}]}";
		String listStr = JSONPath.compile("$.list").eval(JSON.parseObject(str)).toString();
		List<JSONObject> list = JSON.parseArray(listStr, JSONObject.class);
		for (JSONObject s : list) {
			CompanyInfo c = new CompanyInfo();
			String Stockname = JSONPath.compile("$.Stockname").eval(s).toString();
			int t = Stockname.indexOf("(");
			String sname = Stockname.substring(0, t);
			String stock_code = Stockname.substring(t + 1, Stockname.length() - 1);
			c.setSname(sname);
			c.setStockCode(stock_code);
			String industry = new XpathSelector("//a/text()").select(JSONPath.compile("$.deviation").eval(s).toString()).replaceAll(" ", "");
			c.setIndustry(industry);
			String t_institutional = JSONPath.compile("$.Institutional").eval(s).toString();// 注册资本
			double institutional = 0;
			try {
				institutional = Double.parseDouble(t_institutional);
			} catch (NumberFormatException e) {
				institutional = 0;
			}
			c.setInstitutional(institutional);
			float lootchips = getFloat(JSONPath.compile("$.lootchips").eval(s).toString());
			float pricelimit = getFloat(JSONPath.compile("$.Pricelimit").eval(s).toString());
			float shareholders = getFloat(JSONPath.compile("$.shareholders").eval(s).toString());
			c.setLootchips(Double.valueOf(Float.toString(lootchips)));
			c.setPricelimit(Double.valueOf(Float.toString(pricelimit)));
			c.setShareholders(Double.valueOf(Float.toString(shareholders)));
			System.out.println(ToStringBuilder.reflectionToString(c));
		}
		
	}
	private float getFloat(String s) {
		float r;
		try {
			r = Float.parseFloat(s);
		} catch (NumberFormatException e) {
			r = 0f;
		}
		return r;
	}
	@Test
	public void test3() throws InterruptedException{
		Calendar a = Calendar.getInstance();
		Thread.sleep(1000);
		Calendar b = Calendar.getInstance();
		System.out.println(a.hashCode()==b.hashCode());
	}
}
